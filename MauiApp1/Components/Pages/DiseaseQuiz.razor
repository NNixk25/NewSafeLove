@page "/disease-quiz"
@using System.Diagnostics

<div class="quiz-container">
    <h2 class="text-center mb-4">📝 แบบทดสอบความรู้</h2>

    @if (!quizFinished)
    {
        <div>
            <h5>@questions[currentIndex].Text</h5>

            <div class="options mt-3">
                @foreach (var option in questions[currentIndex].Options)
                {
                    <button class="option-btn w-100 mb-2"
                            @onclick="() => SelectAnswer(option)">
                        @option
                    </button>
                }
            </div>
        </div>
    }
    else
    {
        <div class="text-center">
            <h4>🎉 คุณทำแบบทดสอบเสร็จแล้ว!</h4>
            <p>ได้คะแนน <b>@score</b> / @questions.Count</p>
            <button class="btn-submit mt-3" @onclick="RestartQuiz">เริ่มใหม่</button>
        </div>
    }
</div>

<div class="text-center mt-4">
    <a href="/" class="btn-submit">⬅️ กลับหน้าแรก</a>
</div>

@code {
    [DebuggerDisplay($"{{{nameof(GetDebuggerDisplay)}(),nq}}")]
    private class Question
    {
        public string Text { get; set; } = "";
        public List<string> Options { get; set; } = new();
        public string CorrectAnswer { get; set; } = "";

        private string GetDebuggerDisplay()
        {
            return ToString();
        }
    }

    private List<Question> questions = new()
    {
        new Question {
            Text = "โรคเอดส์เกิดจากเชื้ออะไร?",
            Options = new() { "HIV", "HBV", "HCV", "ไข้หวัดใหญ่" },
            CorrectAnswer = "HIV"
        },
        new Question {
            Text = "การใช้ถุงยางอนามัยช่วยป้องกันโรคติดต่อทางเพศสัมพันธ์ได้หรือไม่?",
            Options = new() { "ได้", "ไม่ได้" },
            CorrectAnswer = "ได้"
        },
        new Question {
            Text = "โรคติดต่อทางเพศสัมพันธ์ใดรักษาไม่หายขาด?",
            Options = new() { "หนองใน", "ซิฟิลิส", "เริม", "หนองในเทียม" },
            CorrectAnswer = "เริม"
        },
        new Question {
            Text = "หากไม่ได้ทำการรักษาโรคซิฟิลิสสามารถลุกลามไปยังอวัยวะใดได้?",
            Options = new() { "ระบบประสาทและสมอง", "ระบบทางเดินหายใจ", "ระบบทางเดินปัสสาวะ", "ระบบย่อยอาหาร" },
            CorrectAnswer = "ระบบประสาทและสมอง"
        },
        new Question {
            Text = "อาการเด่นในระยะที่ 1 ของโรคซิฟิลิสคืออะไร?",
            Options = new() { "มีผื่นขึ้นตามตัว", "มีแผลริมแข็ง (Chancre) ที่อวัยวะเพศ", "มีหูดหงอนไก่ขึ้น", "มีอาการคันเรื้อรัง" },
            CorrectAnswer = "มีแผลริมแข็ง (Chancre) ที่อวัยวะเพศ"
        },
        new Question {
            Text = "โรคเริมที่อวัยวะเพศเกิดจากเชื้อไวรัสชนิดใด?",
            Options = new() { "HIV", "HPV", "HSV", "HBV" },
            CorrectAnswer = "HSV"
        },
        new Question {
            Text = "โรคเริมอวัยวะเพศสามารถรักษาให้หายขาดได้หรือไม่?",
            Options = new() { "หายขาดได้ด้วยยาปฏิชีวนะ", "หายขาดได้ด้วยการฉีดวัคซีน", "ไม่สามารถรักษาให้หายขาดได้ แต่ควบคุมอาการด้วยยาต้านไวรัส", "หายเองได้ทุกครั้งโดยไม่ต้องใช้ยา" },
            CorrectAnswer = "ไม่สามารถรักษาให้หายขาดได้ แต่ควบคุมอาการด้วยยาต้านไวรัส"
        },
        new Question {
            Text = "โรคหนองในเกิดจากเชื้อใด?",
            Options = new() { "เชื้อไวรัสเอชไอวี (HIV)", "เชื้อแบคทีเรีย Neisseria gonorrhoeae", "เชื้อราแคนดิดา (Candida)", "เชื้อไวรัส HPV" },
            CorrectAnswer = "เชื้อแบคทีเรีย Neisseria gonorrhoeae"
        },
        new Question {
            Text = "วิธีรักษาโรคหนองในที่ได้ผลดีที่สุดคืออะไร?",
            Options = new() { "การกินยาสมุนไพร", "การใช้ยาต้านไวรัส", "การใช้ยาปฏิชีวนะตามแพทย์สั่ง", "การพักผ่อนให้เพียงพอ" },
            CorrectAnswer = "การใช้ยาปฏิชีวนะตามแพทย์สั่ง"
        },
        new Question {
            Text = "ข้อใดไม่ใช่วิธีติดต่อของโรคเอดส์",
            Options = new() { "ติดต่อโดยการใช้เข็มฉีดยาร่วมกัน", "ติดต่อโดยการออรัลเซ็ก", "ติดต่อด้วยการนั่งใกล้กัน", "ติดต่อด้วยการสัมผัสโดยอีกฝ่ายเป็นแผลสด" },
            CorrectAnswer = "ติดต่อด้วยการนั่งใกล้กัน"
        }
    };

    private int currentIndex = 0;
    private int score = 0;
    private bool quizFinished = false;

    private void SelectAnswer(string selectedOption)
    {
        if (selectedOption == questions[currentIndex].CorrectAnswer)
        {
            score++;
        }

        if (currentIndex < questions.Count - 1)
        {
            currentIndex++;
        }
        else
        {
            quizFinished = true;
        }
    }

    private void RestartQuiz()
    {
        currentIndex = 0;
        score = 0;
        quizFinished = false;
    }
}
